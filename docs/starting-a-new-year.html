<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Chapter 2 Starting a new year | OHI Global Assessment Guide</title>
  <meta name="description" content="A guide for conducting the OHI Global Assessment">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="Chapter 2 Starting a new year | OHI Global Assessment Guide" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A guide for conducting the OHI Global Assessment" />
  <meta name="github-repo" content="openscapes/series" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Starting a new year | OHI Global Assessment Guide" />
  
  <meta name="twitter:description" content="A guide for conducting the OHI Global Assessment" />
  

<meta name="author" content="OHI Team">


<meta name="date" content="2019-03-08">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="index.html">
<link rel="next" href="data-prep.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />










<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">OHI Global Guide</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview</a></li>
<li class="chapter" data-level="2" data-path="starting-a-new-year.html"><a href="starting-a-new-year.html"><i class="fa fa-check"></i><b>2</b> Starting a new year</a><ul>
<li class="chapter" data-level="2.1" data-path="starting-a-new-year.html"><a href="starting-a-new-year.html#review-and-organize-relevant-issues"><i class="fa fa-check"></i><b>2.1</b> Review and organize relevant issues</a></li>
<li class="chapter" data-level="2.2" data-path="starting-a-new-year.html"><a href="starting-a-new-year.html#prepare-the-repositories"><i class="fa fa-check"></i><b>2.2</b> Prepare the repositories!</a><ul>
<li class="chapter" data-level="2.2.1" data-path="starting-a-new-year.html"><a href="starting-a-new-year.html#ohiprep-repository"><i class="fa fa-check"></i><b>2.2.1</b> ohiprep repository</a></li>
<li class="chapter" data-level="2.2.2" data-path="starting-a-new-year.html"><a href="starting-a-new-year.html#ohi-global"><i class="fa fa-check"></i><b>2.2.2</b> ohi-global</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="starting-a-new-year.html"><a href="starting-a-new-year.html#keeping-track-of-layer-progress"><i class="fa fa-check"></i><b>2.3</b> Keeping track of layer progress</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-prep.html"><a href="data-prep.html"><i class="fa fa-check"></i><b>3</b> Data Prep</a><ul>
<li class="chapter" data-level="3.1" data-path="data-prep.html"><a href="data-prep.html#file-organization"><i class="fa fa-check"></i><b>3.1</b> File organization</a><ul>
<li class="chapter" data-level="3.1.1" data-path="data-prep.html"><a href="data-prep.html#saving-external-data"><i class="fa fa-check"></i><b>3.1.1</b> Saving external data</a></li>
<li class="chapter" data-level="3.1.2" data-path="data-prep.html"><a href="data-prep.html#globalprep-files"><i class="fa fa-check"></i><b>3.1.2</b> globalprep files</a></li>
<li class="chapter" data-level="3.1.3" data-path="data-prep.html"><a href="data-prep.html#intermediate-files-that-are-too-large-for-github"><i class="fa fa-check"></i><b>3.1.3</b> Intermediate files that are too large for Github</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="data-prep.html"><a href="data-prep.html#starting-a-new-data-prep-project"><i class="fa fa-check"></i><b>3.2</b> Starting a new data prep project</a><ul>
<li class="chapter" data-level="3.2.1" data-path="data-prep.html"><a href="data-prep.html#prepare-the-dataprep-folder"><i class="fa fa-check"></i><b>3.2.1</b> Prepare the dataprep folder</a></li>
<li class="chapter" data-level="3.2.2" data-path="data-prep.html"><a href="data-prep.html#start-an-issue"><i class="fa fa-check"></i><b>3.2.2</b> Start an issue</a></li>
<li class="chapter" data-level="3.2.3" data-path="data-prep.html"><a href="data-prep.html#update-the-files"><i class="fa fa-check"></i><b>3.2.3</b> Update the files</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data-prep.html"><a href="data-prep.html#a-typical-data-prep-script"><i class="fa fa-check"></i><b>3.3</b> A typical data prep script</a></li>
<li class="chapter" data-level="3.4" data-path="data-prep.html"><a href="data-prep.html#prep-rmd-1.-summary"><i class="fa fa-check"></i><b>3.4</b> prep Rmd: 1. Summary</a></li>
<li class="chapter" data-level="3.5" data-path="data-prep.html"><a href="data-prep.html#prep-rmd-2.-updates"><i class="fa fa-check"></i><b>3.5</b> prep Rmd: 2. Updates</a></li>
<li class="chapter" data-level="3.6" data-path="data-prep.html"><a href="data-prep.html#prep-rmd-3.-data-sources"><i class="fa fa-check"></i><b>3.6</b> prep Rmd: 3. Data sources</a></li>
<li class="chapter" data-level="3.7" data-path="data-prep.html"><a href="data-prep.html#prep-rmd-4.-set-up"><i class="fa fa-check"></i><b>3.7</b> prep Rmd: 4. Set up</a><ul>
<li class="chapter" data-level="3.7.1" data-path="data-prep.html"><a href="data-prep.html#packages"><i class="fa fa-check"></i><b>3.7.1</b> Packages</a></li>
<li class="chapter" data-level="3.7.2" data-path="data-prep.html"><a href="data-prep.html#common.r"><i class="fa fa-check"></i><b>3.7.2</b> common.R</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="data-prep.html"><a href="data-prep.html#prep-rmd-5.-data-prep"><i class="fa fa-check"></i><b>3.8</b> prep Rmd: 5. Data prep</a></li>
<li class="chapter" data-level="3.9" data-path="data-prep.html"><a href="data-prep.html#prep-rmd-6.-gapfilling"><i class="fa fa-check"></i><b>3.9</b> prep Rmd: 6. Gapfilling</a></li>
<li class="chapter" data-level="3.10" data-path="data-prep.html"><a href="data-prep.html#prep-rmd-7.-results-check"><i class="fa fa-check"></i><b>3.10</b> prep Rmd: 7. Results check</a></li>
<li class="chapter" data-level="3.11" data-path="data-prep.html"><a href="data-prep.html#prep-rmd-8.-final-run"><i class="fa fa-check"></i><b>3.11</b> prep Rmd: 8. Final run</a></li>
<li class="chapter" data-level="3.12" data-path="data-prep.html"><a href="data-prep.html#notes-on-parallel-processing"><i class="fa fa-check"></i><b>3.12</b> Notes on parallel processing</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="updating-scores.html"><a href="updating-scores.html"><i class="fa fa-check"></i><b>4</b> Updating scores</a><ul>
<li class="chapter" data-level="4.1" data-path="updating-scores.html"><a href="updating-scores.html#create-results-folder"><i class="fa fa-check"></i><b>4.1</b> Create results folder</a></li>
<li class="chapter" data-level="4.2" data-path="updating-scores.html"><a href="updating-scores.html#final-score-review"><i class="fa fa-check"></i><b>4.2</b> Final score review</a></li>
<li class="chapter" data-level="4.3" data-path="updating-scores.html"><a href="updating-scores.html#methods-document"><i class="fa fa-check"></i><b>4.3</b> Methods document</a><ul>
<li class="chapter" data-level="4.3.1" data-path="updating-scores.html"><a href="updating-scores.html#steps-to-updating-methods-document"><i class="fa fa-check"></i><b>4.3.1</b> Steps to updating methods document</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="updating-scores.html"><a href="updating-scores.html#results-document"><i class="fa fa-check"></i><b>4.4</b> Results document</a></li>
<li class="chapter" data-level="4.5" data-path="updating-scores.html"><a href="updating-scores.html#updates-document"><i class="fa fa-check"></i><b>4.5</b> Updates document</a></li>
<li class="chapter" data-level="4.6" data-path="updating-scores.html"><a href="updating-scores.html#upload-to-a-repository"><i class="fa fa-check"></i><b>4.6</b> Upload to a repository</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">OHI Global Assessment Guide</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="starting-a-new-year" class="section level1">
<h1><span class="header-section-number">Chapter 2</span> Starting a new year</h1>
<p>There are several steps to beginning a year’s assessment. This guide walks through the steps you will want to take. Each of the following steps is described in detail:</p>
<ol style="list-style-type: decimal">
<li>Review and organize relevant github issues</li>
<li>Prepare the repositories
<ul>
<li>ohiprep</li>
<li>ohi-global</li>
</ul></li>
<li>Keeping track of layer progress</li>
</ol>
<div id="review-and-organize-relevant-issues" class="section level2">
<h2><span class="header-section-number">2.1</span> Review and organize relevant issues</h2>
<p>Review the github::issues and create a list linking to the particular issues that might be useful in the year to come. This can include:</p>
<ul>
<li>references/discussion that may lead to improvements to goal models, pressures or resilience</li>
<li>new datasets that are worth exploring</li>
<li>potential newimprovements to ohicore</li>
<li>ideas for reorganizing/cleaning repos</li>
<li>etc.</li>
</ul>
<p>Create a new issue that organizes and links to these issues. This officially marks the start of the OHI assessment!</p>
<p>(This is also a good time to close issues that are completed or no longer relevant)</p>
<p><br> <br></p>
</div>
<div id="prepare-the-repositories" class="section level2">
<h2><span class="header-section-number">2.2</span> Prepare the repositories!</h2>
<p>In preparation for the new assessment, you will need to prepare the repositories we use for the global assessment.</p>
<p>For the ohiprep repository, you will actually copy the previous year’s assessment into a new repository with an updated name and delete the history. This helps to keep the size of the repository under control. For the ohi-global repository, you will update a couple files and perform a couple checks to make sure the scores do not change.</p>
<p>ohicore will probably not need any changes. However, now is a good time to improve warning messages or add functions to improve analysis and visualization.</p>
<p>This is also a good time to think about making organizational changes to the repositories. Sometimes an organizational scheme that worked well in the past doesn’t work as well over time.</p>
<div id="ohiprep-repository" class="section level3">
<h3><span class="header-section-number">2.2.1</span> ohiprep repository</h3>
<p>Create a copy of the most recent ohiprep repository and rename with the new assessment year. I use the following steps to do this:</p>
<ol style="list-style-type: decimal">
<li>If you don’t have the most recent year’s repository, clone it to your local machine. For example, if the last completed assessment was in 2018, you would clone the <a href="https://github.com/OHI-Science/ohiprep_v2018" class="uri">https://github.com/OHI-Science/ohiprep_v2018</a>. Here is one approach using RStudio: <br> <img src="images/clone_repo_1.png" /> <br> <br> <img src="images/clone_repo_2.png" /> <br> <br> <img src="images/clone_repo_3.png" /> <br> <br> <img src="images/clone_repo_4.png" /></li>
</ol>
<p><br> <br> 2. Navigate to <a href="https://github.com/OHI-Science" class="uri">https://github.com/OHI-Science</a> and create a new repository:</p>
<div class="figure">
<img src="images/new_ohiprep_repo.png" />

</div>
<p><br> <br> Use the following parameters (but change the year in the repository name to match the current assessment year): <br> <br> <img src="images/new_ohiprep_repo.png" /> <br> <br> 3. Copy the contents of the old ohiprep repository into the newly created repository. Open the ohiprep_v20?? project in RStudio, and navigate to the Shell: <br> <br> <img src="images/shell.png" /> <br> <br> Make sure that you are in the old ohiprep working directory. This is indicated by the: <code>C:\Users\Melanie\github\ohiprep_v2018</code></p>
<p>If you are not in the correct working directory use the <code>cd</code> command to navigate there. Type in the mirror command:</p>
<p><img src="images/mirror_repo.png" /> <br> <br> 4. Navigate to the new repository on Github.com, <a href="https://github.com/OHI-Science/ohiprep_v20" class="uri">https://github.com/OHI-Science/ohiprep_v20</a>??.git and make sure the folders/files are there. Check that the default branch is “gh-pages” (and not the “master” branch).</p>
<p><br></p>
<ol start="5" style="list-style-type: decimal">
<li>Clone the new repo to your local system (instructions in step 1)</li>
</ol>
<p><br> 6. Delete the commit history of the new repository. This gives us a clean slate to work from and keeps the repository from getting quite as big. I follow the general instructions from <a href="https://gist.github.com/heiswayi/350e2afda8cece810c0f6116dadbe651">here</a>. Make sure you are in the working directory of the new repository, and in the shell type the following:</p>
<pre><code>
# Check out to a temporary branch:
git checkout --orphan TEMP_BRANCH

# Add all the files:
git add -A

# Commit the changes:
git commit -am &quot;Initial commit&quot;

# Delete the old branch:
git branch -D gh-pages

# Rename the temporary branch to master:
git branch -m gh-pages

# Finally, force update to our repository:
git push -f origin gh-pages
</code></pre>
<p><br></p>
<ol start="7" style="list-style-type: decimal">
<li>Navigate to the new repository on Github.com, <a href="https://github.com/OHI-Science/ohiprep_v20" class="uri">https://github.com/OHI-Science/ohiprep_v20</a>??.git and check whether there is only one commit. <br></li>
</ol>
<div class="figure">
<img src="images/new_repo.png" />

</div>
<p><br> <br> 8. Update README.md and delete unnecessary .Rproj files with the wrong year, commit, push.</p>
<p><br></p>
<ol start="9" style="list-style-type: decimal">
<li>You are done….go have a cup of tea!</li>
</ol>
</div>
<div id="ohi-global" class="section level3">
<h3><span class="header-section-number">2.2.2</span> ohi-global</h3>
<p>The main files that get updated are:</p>
<ul>
<li>eez/conf/scenario_data_years.csv</li>
<li>eez/calculate_scores.R</li>
</ul>
<div id="scenario_data_years.csv" class="section level4">
<h4><span class="header-section-number">2.2.2.1</span> scenario_data_years.csv</h4>
<p>For each data layer, the scenario_data_years.csv associates the year the source data was collected or reported with the OHI assessment year. The data looks like this:</p>
<div class="figure">
<img src="images/scenario_data_years.png" />

</div>
<p>In this case, the data layer for ao_access (access to artisanal fishing opportunities data used to calculate the score for the artisanal opportunities goal) goes from 2008 to the most current assessment year (not shown). The first OHI global assessment was in 2012 but the data goes to 2008 because five years of data are typically required to calculate trend. In this case, the 2012 trend was calculated using data from 2008 to 2012. The data year is 2013 for all assessment years because these particular data have never been updated.</p>
<p>There is a helper script (eez_layers_meta_data/new_year_prep.R) that updates this file when embarking on a new assessment year. This script adds an additional assessment year to the eez/conf/scenario_data_years.csv. The data year is the same as the previous assessment year. As each data layer is added to update scores, the data year must be manually updated directly within the eez/conf/scenario_data_years.csv.</p>
<div class="figure">
<img src="images/update_script_scenario_data_years.png" />

</div>
</div>
<div id="calculate_all.r" class="section level4">
<h4><span class="header-section-number">2.2.2.2</span> calculate_all.R</h4>
<p>The calculate_all.R script, located in the eez folder, is the main script used to calculate scores. This script creates objects used by ohicore functions, calls ohicore functions that calculate scores, and includes code to check results.</p>
<p>This script needs to be updated for a new assessment year. Specfically, links to the ohiprep repository (step 2) and the most recent assessment year (step 3) must be updated.</p>
<p>Once this script is updated, it is critical to walk through the entire script to make sure all the steps are working and there are no changes to the previous year’s scores. The <code>ohicore::CheckLayers</code> function will likely generate some warnings. The following warnings are expected and do not indicate a problem:</p>
<div class="figure">
<img src="images/CheckLayers_errors.png" />

</div>
<p>Once the scores are generated, it is important to run the score_check function (step 10). For the scenario_year argument, be sure to provide the year of the most recent completed assessment:</p>
<div class="figure">
<img src="images/data_check_code.png" />

</div>
<p>Once, this is run, check the html file that is created. This file will be in the eez/score_check folder with the name provided in the function (in the above example file_name = “check_2019_assess”) with the date it was generated. Ideally, this will be a very boring plot comprised of a series of yellow bars, indicating that nothing changed. Sadly, you may actually see something like this:</p>
<div class="figure">
<img src="images/data_check_plot.png" />

</div>
<p>At first glance, the changes to mariculture (and the corresponding food provision goal) and natural products and tourism is worrisome. If there have been no changes to models or data, these should be the same. However, I am somewhat reassured that all the changes are fairly small (&lt;1 point change in score). Regardless, these changes must be explained to convince ourselves that nothing is wrong.</p>
<p>In the Git window, I notice that there were some changes to some reference point files. Further exploration reveals that adding an additional year changed the reference points of the mariculture and tourism and recreation goals. This change is fine because the reference points are calculated using all years of data. The small natural product goal changed for the similar reasons.</p>
<div class="figure">
<img src="images/change_in_ref_points.png" />

</div>
<p>I have now convinced myself that all is well.</p>
<p>The final step of this process is to delete the eez/data_check folder. This will be created again at the start of the new assessment! Even though this folder is deleted, the files are preserved in the Git history. We don’t really want this, because these files will not be useful in the future and they are fairly large. This makes the ohi-global more bulky than it needs to be. Eventually, we will want to figure out how to delete these large files from Git history. But I wouldn’t bother until it becomes a problem (i.e., when the ohi-global repository starts taking a crazy long time to clone locally).</p>
</div>
</div>
</div>
<div id="keeping-track-of-layer-progress" class="section level2">
<h2><span class="header-section-number">2.3</span> Keeping track of layer progress</h2>
<p>We use a Google Sheet to help us keep track of where we are in the process of preparing data for the OHI global. The following is part of the 2019 global assessemnt layers checklist:</p>
<div class="figure">
<img src="images/layers_checklist.png" />

</div>
<p>The main part of the checklist is created using code in ohi-global/eez_layers_meta_data/new_year_prep.R.</p>
<p>However, the “Notes” are added in secondarily. The “Notes” can be used for many things during this process of conducting an assessment, but starting notes include information that is helpful while preparing the data.</p>
<p>These notes are likely to change every year, but here is a place to start:</p>
<table style="width:86%;">
<colgroup>
<col width="13%" />
<col width="72%" />
</colgroup>
<thead>
<tr class="header">
<th>Notes</th>
<th>layers</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>not updated, no new data</td>
<td>ao_access, cw_trash_trend, eco_status, eco_trend, liv_status, liv_trend, fp_habitat, fp_mora, fp_mora_artisanal, g_mariculture, g_msi_gov, g_tourism, hab_coral_health, hab_coral_trend, hab_mangrove_health, hab_mangrove_trend, hab_saltmarsh_health, hab_saltmarsh_trend, hab_seagrass_health, hab_seagrass_trend, hd_habitat, had_subtidal_hb, le_sector_weight, li_sector_evenness, np_blast, np_cyanide, po_trash, po_water, sp_alien, sp_alien_species</td>
</tr>
<tr class="even">
<td>not updated, considered static data</td>
<td>hab_coral_extent, hab_mangrove_extent, hab_rockyreef_extent, hab_saltmarsh_extent, hab_seagrass_extent, hab_softbottom_extent, rgn_area, rgn_area_inland1km, rgn_area_offshore3nm, rgn_global, rgn_labesl, sp_alien, sp_alien_species, uninhabited</td>
</tr>
<tr class="odd">
<td>not updated, updated in functions.R</td>
<td>element_wts_cp_km2_x_protection, element_wts_cs_km2_x_storage, element_wts_hab_pres_abs</td>
</tr>
<tr class="even">
<td>generated with LSP data</td>
<td>fp_mpa_coast, fp_mpa_eez, hd_mpa_coast, hd_mpa_eez</td>
</tr>
<tr class="odd">
<td>generated with SPP data</td>
<td>species_diversity_3nm, species_diversity_eez</td>
</tr>
<tr class="even">
<td>WGI data</td>
<td>ss_wgi, wgi_all (pressure and resilience, inverse of one another)</td>
</tr>
<tr class="odd">
<td>SPI data</td>
<td>ss_spi, res_spi (pressure and resilience, inverse of one another)</td>
</tr>
<tr class="even">
<td>before doing this layer, run code in mar_prs_population</td>
<td>cw_pathogen_trend</td>
</tr>
<tr class="odd">
<td>layer generated by mariculture script</td>
<td>sp_genetic</td>
</tr>
</tbody>
</table>
<p>This is also a good time to do a literature search (and review issues during the past year) to determine whether there are new data sources for the layers that aren’t updated because new source data is unavailable.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-prep.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/OHI-Science/ohi-global-guide/edit/master/start_new_year.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["series.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
